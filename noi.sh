#! /bin/sh

TK=$(node -e "var https = require(\"https\"); function sM(a) { var b; if (null !== yr) b = yr; else { b = wr(String.fromCharCode(84)); var c = wr(String.fromCharCode(75)); b = [b(), b()]; b[1] = c(); b = (yr = window[b.join(c())] || \"\") || \"\" } var d = wr(String.fromCharCode(116)) , c = wr(String.fromCharCode(107)) , d = [d(), d()]; d[1] = c(); c = \"&\" + d.join(\"\") + \"=\"; d = b.split(\".\"); b = Number(d[0]) || 0; for (var e = [], f = 0, g = 0; g < a.length; g++) { var l = a.charCodeAt(g); 128 > l ? e[f++] = l : (2048 > l ? e[f++] = l >> 6 | 192 : (55296 == (l & 64512) && g + 1 < a.length && 56320 == (a.charCodeAt(g + 1) & 64512) ? (l = 65536 + ((l & 1023) << 10) + (a.charCodeAt(++g) & 1023), e[f++] = l >> 18 | 240, e[f++] = l >> 12 & 63 | 128) : e[f++] = l >> 12 | 224, e[f++] = l >> 6 & 63 | 128), e[f++] = l & 63 | 128) } a = b; for (f = 0; f < e.length; f++) a += e[f], a = xr(a, \"+-a^+6\"); a = xr(a, \"+-3^+b+-f\"); a ^= Number(d[1]) || 0; 0 > a && (a = (a & 2147483647) + 2147483648); a %= 1E6; return c + (a.toString() + \".\" + (a ^ b)) } var yr = null; var wr = function(a) { return function() { return a } } , xr = function(a, b) { for (var c = 0; c < b.length - 2; c += 3) { var d = b.charAt(c + 2) , d = \"a\" <= d ? d.charCodeAt(0) - 87 : Number(d) , d = \"+\" == b.charAt(c + 1) ? a >>> d : a << d; a = \"+\" == b.charAt(c) ? a + d & 4294967295 : a ^ d } return a }; var config = {}; var window = { TKK: config[\"TKK\"] || \"0\" }; function updateTKK() { return new Promise(function (resolve, reject) { var now = Math.floor(Date.now() / 3600000); if (Number(window.TKK.split(\".\")[0]) === now) { resolve(); } else { https.get(\"https://translate.google.com\", (res) => { res.setEncoding(\"utf8\"); let body =\"\"; res.on(\"data\", data => { body += data }); res.on(\"end\", () => { var code = body.match(/TKK=(.*?)\(\)\)'\);/g); if (code) { eval(code[0]); /* eslint-disable no-undef */ if (typeof TKK !== \"undefined\") { window.TKK = TKK; config[\"TKK\"] = TKK; } /* eslint-enable no-undef */ } resolve(); }); }); } }); } function get(text) { return updateTKK().then(function () { var tk = sM(text); tk = tk.replace(\"&tk=\", \"\"); console.log(tk); }).catch(function (err) { throw err; }); };get(process.argv[1])" "$1")

curl -s -G --data-urlencode "q=$1" -H "Cache-Control: no-cache" -H "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Postman/4.3.2 Chrome/47.0.2526.73 Electron/0.36.2 Safari/537.36" -H "Postman-Token: 951cc78d-759b-2180-855b-38517d7e6fa2" "https://translate.google.com/translate_tts?ie=UTF-8&tl=vi&client=t&tk=$TK&textlen=14" -o /tmp/phase
afplay /tmp/phase
